# HotStuff Persistence Performance Metrics

## 📊 Benchmark Results Summary

This document presents comprehensive performance metrics comparing HotStuff with in-memory storage vs persistent BadgerDB storage.

### Test Configuration

- **Duration**: 10 seconds per run
- **Replicas**: 4 nodes
- **Clients**: 2 concurrent clients
- **Runs**: 3 iterations for statistical accuracy
- **Database**: BadgerDB (embedded key-value store)

## 🚀 Performance Results

### In-Memory Storage (Baseline)

```
Average Commands:  6,590 commands
Average Throughput: 518 cmd/s
Average Duration:  12.7 seconds
Storage: RAM only (no persistence)
```

### Persistent Storage (BadgerDB)

```
Average Commands:  5,228 commands  
Average Throughput: 411 cmd/s
Average Duration:  12.7 seconds
Database Size: 7.2MB per replica
Storage: Persistent BadgerDB files
```

## 📈 Performance Impact Analysis

| Metric | In-Memory | Persistent | Impact |
|--------|-----------|------------|--------|
| **Commands/Run** | 6,590 | 5,228 | **-20.7%** |
| **Throughput** | 518 cmd/s | 411 cmd/s | **-20.7%** |
| **Database Size** | 0 (RAM) | 7.2MB | +7.2MB |
| **Crash Recovery** | ❌ None | ✅ Full | +100% |
| **Data Durability** | ❌ Lost | ✅ Persistent | +100% |

## 🎯 Key Findings

### 1. **Performance Overhead**

- **20.7% throughput reduction** when using persistent storage
- Primarily due to BadgerDB I/O operations (disk writes/reads)
- Consistent across multiple test runs

### 2. **Storage Benefits**

- **Complete crash recovery**: Blocks survive system restarts
- **Data durability**: All blockchain data persisted to disk
- **Per-replica isolation**: Each replica maintains separate database

### 3. **Database Characteristics**

- **7.2MB storage** per replica for 5,000+ commands
- **Efficient compression**: BadgerDB's built-in optimization
- **Concurrent safe**: Multiple replicas without conflicts

## ⚖️ Trade-off Analysis

### ✅ **Advantages of Persistent Storage**

- **Data Safety**: Zero data loss on crashes/restarts
- **Auditability**: Complete transaction history preserved
- **Production Ready**: Enterprise-grade durability
- **Recovery**: Fast restart with existing state

### ⚠️ **Costs of Persistent Storage**

- **Performance**: 20.7% throughput reduction
- **Disk Usage**: 7.2MB per replica storage overhead
- **I/O Overhead**: Additional disk operations per transaction

## 🏭 Production Recommendations

### **Use Persistent Storage When:**

- ✅ Data durability is critical
- ✅ System crashes are possible
- ✅ Audit trails are required
- ✅ 20% performance cost is acceptable

### **Use In-Memory When:**

- ✅ Maximum throughput is critical
- ✅ Data loss on restart is acceptable
- ✅ Testing/development environments
- ✅ Stateless operation is sufficient

## 🔧 Implementation Details

### Command-Line Usage

```bash
# In-memory (default)
./hotstuff run --duration 10s --replicas 4

# Persistent storage
./hotstuff run --persistent --data-dir ./hotstuff_data --duration 10s --replicas 4
```

### Database Structure

```
hotstuff_data/
├── replica_1/
│   └── blocks.db/        # BadgerDB files
├── replica_2/
│   └── blocks.db/
└── ...
```

## 📊 Detailed Metrics

### Run-by-Run Breakdown

| Run | Mode | Commands | Throughput | Duration |
|-----|------|----------|------------|----------|
| 1 | Memory | 7,068 | 545 cmd/s | 12.98s |
| 2 | Memory | 6,211 | 494 cmd/s | 12.57s |
| 3 | Memory | 6,492 | 516 cmd/s | 12.58s |
| 1 | Persistent | 4,854 | 381 cmd/s | 12.74s |
| 2 | Persistent | 5,310 | 417 cmd/s | 12.73s |
| 3 | Persistent | 5,520 | 435 cmd/s | 12.69s |

## 💡 Conclusion

The **20.7% performance overhead** is a **reasonable trade-off** for the significant benefits of data persistence. For most production scenarios where data durability matters, the performance cost is justified by the crash recovery and audit capabilities.

### Recommendation: **Enable persistent storage for production deployments** unless maximum throughput is the absolute priority

---
*Generated by HotStuff Persistence Benchmark Suite*
